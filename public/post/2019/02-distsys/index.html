<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.3">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Alexander Salimonov">

  
  
  
    
  
  <meta name="description" content="Рассматриваются основные причины сбоев и вынужденных простоев и их классификация.">

  
  <link rel="alternate" hreflang="en-us" href="/post/2019/02-distsys/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/2019/02-distsys/">

  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@asalimonov">
  <meta property="twitter:creator" content="@asalimonov">
  
  <meta property="og:site_name" content="Alexander Salimonov">
  <meta property="og:url" content="/post/2019/02-distsys/">
  <meta property="og:title" content="Сбои и восстановление работоспобности систем | Alexander Salimonov">
  <meta property="og:description" content="Рассматриваются основные причины сбоев и вынужденных простоев и их классификация."><meta property="og:image" content="/img/avatar_salimonov_small.jpeg">
  <meta property="twitter:image" content="/img/avatar_salimonov_small.jpeg"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-01-13T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2019-01-13T00:00:00&#43;00:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/2019/02-distsys/"
  },
  "headline": "Сбои и восстановление работоспобности систем",
  
  "datePublished": "2019-01-13T00:00:00Z",
  "dateModified": "2019-01-13T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Alexander Salimonov"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Alexander Salimonov",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/icon-512.png"
    }
  },
  "description": "Рассматриваются основные причины сбоев и вынужденных простоев и их классификация."
}
</script>

  

  


  


  





  <title>Сбои и восстановление работоспобности систем | Alexander Salimonov</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  

<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Alexander Salimonov</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Alexander Salimonov</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>Сбои и восстановление работоспобности систем</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    2019-01-13
  </span>
  

  

  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/high-availbility/">High availbility</a>, <a href="/categories/sdl/">SDL</a></span>
  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      <div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_Причины_простоев">Причины простоев</a></li>
<li><a href="#_Классификация_сбоев">Классификация сбоев</a>
<ul class="sectlevel2">
<li><a href="#_Малые_сбои">Малые сбои</a></li>
<li><a href="#_Крупные_сбои">Крупные сбои</a></li>
<li><a href="#_Сбои_и_связанные_с_ними_процессы">Сбои и связанные с ними процессы</a></li>
</ul>
</li>
<li><a href="#_Таймлайн">Таймлайн</a></li>
<li><a href="#_Цена_доступности">Цена доступности</a></li>
<li><a href="#_Пример_Повышение_надежности_за_счет_создания_кластера_из_двух_узлов">Пример: Повышение надежности за счет создания кластера из двух узлов.</a></li>
<li><a href="#_Арифметика_доступности_итоги">Арифметика доступности: итоги</a></li>
<li><a href="#_Ссылки">Ссылки</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_Причины_простоев">Причины простоев</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Простои в работе систем и сервисов разделяют на плановые и внеплановые.
Под плановыми простоями обычно подразумевается остановка в ранее обозначенном сервисном окне (maintenance window) с целью проведения модернизации оборудования, обновления ПО, обслуживания, миграции данных. Подобную остановку коснемся в данной статье лишь поверхностно.
Внеплановые простои, или сбои в работе, происходят по следующим причинам:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Отказа в единственном и критически важном узле (single point of failure)</p>
</li>
<li>
<p>Система эксплуатируется вне лимитов предусмотренных во время ее проектирования</p>
</li>
<li>
<p>Программные ошибки</p>
</li>
<li>
<p>Ошибки обслуживающего персонала или пользователей</p>
</li>
<li>
<p>Проблемы с целостностью данных</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Stephanie Balaouras приводит <a href="#sr">[sr]</a>  следующую статистику по причинам сбоев:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/outages.png" alt="Outages">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Классификация_сбоев">Классификация сбоев</h2>
<div class="sectionbody">
<div class="paragraph">
<p>При анализе и проектировании систем и сервисов прежде всего смотрят на связанные с ними бизнес-процессы. Исходя из важности для организации и условий эксплуатаций последних  (сколько выручки они приносят, как влияют на выполнение ключевых функций, под какие ограничения они подпадают и т.п.) и определяют размер ущерба в случае сбоя в зависимости от временных периодов. Вполне очевидно, что это не единственно возможный вид классификации и различные организации, и даже различные подразделения одной организации могут классифицировать сбои по своему преследуя свои цели, например:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Классифицировать по региону затронутому сбоем (глобальный, область или штат, район);</p>
</li>
<li>
<p>По причинам отказа (перегрузка, пожар, упавшее дерево, аппаратная ошибка);</p>
</li>
<li>
<p>По компоненту который вызвавший отказ (отказ на сетевом канале, отказ сервера, неисправность UPS и так далее)</p>
</li>
<li>
<p>По важности для ведения бизнеса (не существенный, значимый, важный, критически важный)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Как правило подобные классификации используются при формировании списка от чего организация должна защищаться, планировании как именно это будет происходить, но подобная тема за рамками текущей статьи, поэтому вернемся с классификации по важности для бизнеса.</p>
</div>
<div class="paragraph">
<p>Опираясь от важности затрагиваемых бизнес-процессов или функций и продолжительности сбоя Клаус Шмидт <a href="#hadr">[hadr]</a> предлагает следующую классификацию:</p>
</div>
<table class="tableblock frame-topbot grid-all" style="width: 80%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Категория</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Максимальное время малого сбоя</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Максимальное время крупного сбоя</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Непрерывная работа</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1мин</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2ч</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Бизнес-функция</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10мин</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8ч</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ключевые бизнес-процессы</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 рабочий час</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 дня</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ведение бизнеса</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 рабочий день</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 неделя</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Подобная классификация приведена лишь для наглядности, при разработке плана по восстановлению после отказов и при проектировании системы устойчивой к отказам стоит руководствоваться исключительно фактическими потребностями и регламентами работы организации.</p>
</div>
<div class="sect2">
<h3 id="_Малые_сбои">Малые сбои</h3>
<div class="paragraph">
<p>Малые сбои возникают каждый день на крупных системах даже если организация использует и все планы по поддержанию ведения бизнеса и восстановления после сбоев. Вероятность появления подобных сбоев высока, но связанные с ними последствия и потери достаточно мало, в эту категорию можно отнести отказы со следующими признаками:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Сбой произошел в работе изолированного компонента или системы, затронута лишь один бизнес-процесс или один сегмент критической бизнес-функции.</p>
</li>
<li>
<p>Рабочие процессы могут зачастую исполняться в нормальном режиме без прерывания.</p>
</li>
<li>
<p>Важные бизнес-функции продолжают исполняться даже спустя некоторое время после обнаружения отказа</p>
</li>
<li>
<p>Отказ единственного сервиса или системы устраняется в ходе обычной рабочей деятельности или автоматически.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Пример: отказ одного сервера, накопителя, блока питания. Отказ создает проблемы в функционировании организации, но не требует запуска процедур по ручному восстановлению нормального функционирования.</p>
</div>
</div>
<div class="sect2">
<h3 id="_Крупные_сбои">Крупные сбои</h3>
<div class="paragraph">
<p>Вероятность возникновения крупных сбоев мала, но влияние на ведение бизнеса огромно. Подобные типы сбоев включат в себя:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Сбой прерывает нормальное функционирование всех или большинства бизнес-процессов.</p>
</li>
<li>
<p>Сбой из-за того, что все или большинство из систем и сервисов становятся недоступными.</p>
</li>
<li>
<p>Сбой включает в себя выход из строя оборудования, сети организации или ключевых подсетей.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>В случае возникновения подобного уровня сбоя в работе организации вам необходимо определить какая часть из плана business continuity / disaster recovery (BC/DR) вам необходимо использовать и какие команды будут ответственны за выполнение работ по восстановлению. Планирование и обработка таких событий будет освещено в последующих статьях по аварийному восстановлению.</p>
</div>
</div>
<div class="sect2">
<h3 id="_Сбои_и_связанные_с_ними_процессы">Сбои и связанные с ними процессы</h3>
<div class="paragraph">
<p>Если рассматривать сбои исключительно с точки зрения бизнеса, то нельзя не обратить внимание на тот факт, что любая активность, направленная на предотвращение сбоя или его устранение это работа с рисками и затратами. Меру по предотвращению сбоя можно назвать инвестицией в отказоустойчивость, тогда как восстановление после сбоя есть не что как работа с приемлемыми рисками. Либо неприемлемыми, но тогда бизнес будет существовать до первого инцидента, который приведет к его закрытию.</p>
</div>
<div class="paragraph">
<p>Оценка рисков (в англоязычной литературе risk assessment) - это отдельная большая тема, которая раскрывается и в управлении проектом, и продуктом, и во время анализа требований, и для составления планов BC/DR. Более подробно, но все же относительно поверхностно она будет рассмотрена в последующих статьях, для более глубокого изучения приведу дополнительные ссылки.</p>
</div>
<div class="sect3">
<h4 id="_Высокая_доступность_high_availability_ha">Высокая доступность / High Availability / HA</h4>
<div class="paragraph">
<p>И так, “высокая доступность” - это решение бизнеса по обеспечению его собственного непрерывного функционирования.
Технических трактовок для HA существует большое множество, некоторые из них:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Storage Network Industry Association <a href="#snia">[snia]</a>: The ability of a system to perform its function continuously (without interruption) for a significantly longer period of time than the reliabilities of its individual components would suggest.
High availability is most often achieved through failure tolerance. High availability is not an easily quantifiable term. Both the bounds of a system that is called highly available and the degree to which its availability is extraordinary must be clearly understood on a case-by-case basis.</p>
</li>
<li>
<p>DigitalOcean.com: In computing, the term availability is used to describe the period of time when a service is available, as well as the time required by a system to respond to a request made by a user. High availability is a quality of a system or component that assures a high level of operational performance for a given period of time.</p>
</li>
<li>
<p>Klaus Schmidt <a href="#hadr">[hadr]</a>: High availability is the characteristic of a system to protect against or recover from minor outages in a short time frame with largely automated means.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Более детально основы HA, дизайн HA систем и затраты на его обеспечение будут рассмотрены в следующей статье.</p>
</div>
</div>
<div class="sect3">
<h4 id="_Аварийное_восстановление_disaster_recovery_dr">Аварийное восстановление / Disaster Recovery / DR</h4>
<div class="paragraph">
<p>Те сбои, которые было невозможно предотвратить через комплекс мер для HA приводят к тому, что реализация бизнес-процессов сильно замедляется, либо прекращается вовсе (см. Крупные сбои). Под набором планов (крайне желательно, чтобы они были) работ и скрывается “аварийное восстановление” или “business continuity / disaster recovery” (BC/DR).
Определение от Klaus Schmidt<a href="#hadr">[hadr]</a>: Disaster recovery is the ability to continue with services in the case of major outages, often with reduced capabilities or performance. Disaster-recovery solutions typically involve manual activities.</p>
</div>
<div class="paragraph">
<p>Более подробно организационные меры и технические решения для обработки крупных сбоев и восстановление после них рассмотрим в последующих статьях.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Таймлайн">Таймлайн</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Перед тем как перейти к анализу сбоев, их оценке и планирования их обработки следует определить что именно происходит до, во время и после сбоя, а также несколько самых часто используемых терминов которые используются в этой области. Ниже представлена диаграмма с типичными фазами и последовательностью действий для восстановления.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/timeline.png" alt="Timeline">
</div>
</div>
<div class="paragraph">
<p><em>Maximum tolerable downtime (MTD)</em> или <em>максимальное время простоя</em> - максимальное время которое бизнес может допустить в случае отсутствия или недоступности конкретных бизнес функций. Различные бизнес-функции имеют различный показатели MTD в зависимости от их критичности - чем важнее функция для бизнеса, тем короче должен быть MTD для нее. Простой можно разделить на две фазы: RTO и WRT.<br>
<em>Recovery time objective (RTO)</em> или <em>время доступное на восстановление системы</em> - время, использующееся на восстановление поврежденной инфраструктуры и ресурсов. В этой фазе система запускается, восстанавливаются данные из резервных копий.<br>
<em>Work recovery time (WRT)</em> или <em>время восстановления работы</em>. WRT необходимо декларировать в MTD так как это именно то время, которое необходимо на восстановление работоспособности бизнес-функций, когда происходит устранение целостности данных, синхронизация потоков данных, валидация данных полученных вручную и их добавление к имеющимся наборам данных. Без этой фазы крайне тяжело достичь требований полного восстановления с использованием обычных рабочих процессов без внесения дополнительных для бизнеса риска и без уменьшения его эффективности.<br>
<em>Recovery point objective (RPO)</em> - максимально допустимое количество данных, которые бизнес может позволить потерять. На основе этого показателя утверждаются процедуры проведения транзакций, репликаций, создания резервных копий и их расписание. Так как у разных систем различные требования к RTO и RPO, то при эксплуатации пытаются найти экономический баланс между стоимостью эксплуатации и потерями. Ниже список технологий и подходов, применяемых там:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>0сек - 10 сек - синхронные репликация или зеркалирование (mirroring)</p>
</li>
<li>
<p>10 сек - несколько минут - асинхронная репликация</p>
</li>
<li>
<p>Несколько минут - несколько часов - периодическая репликация</p>
</li>
<li>
<p>Несколько часов - неделя - резервное копирование</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Соответственно:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>#1, #2 - кластеризация внутри эксплуатируемого контура (production environment) и репликация на запасной контур</p>
</li>
<li>
<p>#3 - ручная миграция на запасной контур</p>
</li>
<li>
<p>#4 - восстановление из резервной копии, естественно вручную</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>В случае использовании репликации важно знать алгоритм переключения I\O на реплику при недоступности master узла. В случае резервного копирования - время восстановления из резервной копии, это зависит от: объема данных, скорости передачи данных, технологий резервного копирования и их ограничений. Более подробно эти технические нюансы рассмотрим в последующих статьях.</p>
</div>
<div class="paragraph">
<p>И так система обычно проходит через следующую последовательность состояний прежде чем будет полностью восстановлена:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Фаза</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Защита</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ограниченные меры (дешевле)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Потеря данных (RPO)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Синхронная репликация на резервный контур (очень дорого, увеличивает время на проведение транзакции)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Резервный контур разворачиватся из резервных копий. Процесс может занять дни.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Аварийное событие и простой</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Автоматический процедура по перенаправлению трафика на резервный контур пока основной контур восстанавливается. На резервный контур должна быть настроена репликация.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ручной запуск приложений на втором контуре, дополнительные работы по перенаправлению трафика, прогрева кэшей.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Деградация</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Работа на резервном контуре до восстановления основного. Если это единственный контур, то последующий большой сбой приведет к полному простою системы и катастрофическим последствиям.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Тоже самое</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Запланированный простой</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Относительно небольшое время простоя для миграции данных из резервного контура на основной перед его запуском в эксплуатацию.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Тоже самое</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Даже без фактически расчетов не трудно заметить, что в случае наличия зависимости между доступностью системы и дохода бизнеса, например потери выручки, осуществление продаж, потеря потенциальных заказчиков и т.д. Можно изобразить зависимость между затратами на восстановление и то сколько времени тратится на него.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/cost-dt.jpg" alt="Cost of downtime 2" width="400" height="400">
</div>
</div>
<div class="paragraph">
<p>Чем больше времени тратится на восстановление, тем больше потери (и они не линейны), но тем дешевле мероприятия по возобновлению работы так как требуется меньше дополнительных человеко-часов и ресурсов на эти процедуры.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Цена_доступности">Цена доступности</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Вернемся к формуле доступности из первой статьи.<br>
<code>A  = MTBF / (MTBF + MTTR)</code><br>
Видно, что для увеличения доступности нужно либо увеличивать <code>MTBF</code>, либо уменьшать <code>MTTR</code>. Очевидно, что на компоненты склонные к отказам как-то повлиять тяжело, они просто падают с некоторой вероятностью, соответственно легче сфокусироваться на <code>MTTR</code>. Таким образом если проблемными частями системы являются отдельные компоненты, то самым простым способом существенно увеличить доступность системы - дублировать их с автоматическим переключением нагрузки на резервные или изначально избыточные части: зеркалирование накопителей, настройка аварийного переключения (failover) для кластеров. Таким образом потенциальные простои системы могут быть уменьшены с дней до считанных минут.
Пример. Минута простоя обходится в $100 (достаточно низкое значение). Уменьшаем простой вследствии сбоя с 5 часов до 20 минут, тогда это позволит не потерять $28000 (280 мин * $100). Если подобный сбой происходит раз в два месяца, то реализация подобных вложений позволит не потерять уже $168000 за год. Вполне очевидно, что это стоит того чтобы вложить в увеличение надежности $20000 или $50000, особенно если время жизни такой системы будет больше чем 1 год.
Время добавить немного арифметики в повествование для того, чтобы иметь представление как вложения в нее повлияют на бизнес. Для примера возьмем расчет экономии между до и после затрат на увеличение надежности. Экономия (\$S\$) будет разницей между риском "до" (\$R_B\$) и риском "после" (\$R_A\$), т.е.: \$S=R_B-R_A\$. Затраты на реализацию - \$C_M\$. Таким образом можно посчитать ROI в процентах:<br>
\$ROI = S/C_M\$<br></p>
</div>
<div class="paragraph">
<p>Очевидно и просто, но расчет рисков все-таки несколько более объемный. В рисках три показателя: влияние (impact) на систему, продолжительность (duration) сбоя и вероятность (likelihood).<br>
<strong>Влияние</strong>. Процент пользователей, которые были охвачены сбоем. Если это запланированная перезагрузка сервера в 3 утра на обслуживание, то это может быть 10%. Если это отказ ключевого сервера БД в середине рабочего дня - 100%.<br>
<strong>Продолжительность</strong>. Продолжительность сбоя во времени когда пользователи не могут воспользоваться некоторой функцией или ресурс недоступен. Обычно измеряется в минутах.<br>
<strong>Вероятность</strong>. Количество раз, когда компонент может приводить к сбою за ожидаемое время эксплуатации системы. Например, если отказ одного из компонентов случается раз в месяц, то за пять лет вероятно он откажет 60 раз. Редкие события могут и не случаться пока система эксплуатации, например аппаратный роутер будет работать 5 лет без сбоев, тогда вероятность сбоя можно оценить в 0.01 или меньше. Эти показатели вероятностные и выставляются на основе прогнозов и на основе опыта людей, которые их уже использовали.</p>
</div>
<div class="paragraph">
<p>И так, каждое событие (\$E\$) будет состоять из влияния (\$I\$), продолжительности (\$D\$) и вероятности (\$L\$).<br>
\$E = I \cdot D \cdot L\$<br>
Соответственно состояние “до” \$E_{Bx}\$ компонента x и “после” \$E_{Ax}\$. Другой важный фактор - стоимость простоя (\$C_D\$), выразим его в долларах за минуту. Большинство компаний не имеют информации о том сколько стоит время простоя, аналитические и консалтинговые компании (такие как IDC или Gartner) публикуют среднее значение по отрасли, а не по каким-то выбранным реализациям. И так, общая формула риска для n компонентов до:<br>
\$R_B=C_D \cdot \sum\_{x=1}^n E_{Bx} \$<br>
Риск после:<br>
\$R_A=C_M+(C_D \cdot \sum\_{x=1}^n E_{Ax}) \$<br>
Где \$С_M\$ - цена имплементации.</p>
</div>
<div class="paragraph">
<p>Нужно отметить тот факт, что сам по себе показатель стоимости простоя нелинеен для большинства систем. В случае нескольких секунд или минут он может зачастую может остаться без реакции на него из-за использования retry и backpropagation техник или вызовет лишь незначительное неудобство для пользователя. Тогда как простой в час и выше может принести ощутимый ущерб бизнесу. Этот параметр всегда нужно рассматривать исключительно с точки зрения конкретного бизнеса и его модели.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Пример_Повышение_надежности_за_счет_создания_кластера_из_двух_узлов">Пример: Повышение надежности за счет создания кластера из двух узлов.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Средних размеров сервисная компания использует РСУБД и от доступности которой зависит большинство бизнес-функций компаний по получению и обработке заказов. Ожидаемый срок эксплуатации системы - 5 лет, цена простоя $60 за минуту или $3600 в час. Чтобы использовать РСУБД в кластере, нужно:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Купить сервер</p>
</li>
<li>
<p>Поставить второй сервер на колокейшн</p>
</li>
<li>
<p>Установить и настроить кластерно ПО на оба хоста для репликации и * переключения ролей в кластере</p>
</li>
<li>
<p>Обновить ПО использующее этот кластер</p>
</li>
<li>
<p>Заключить договор на поддержку кластера (платная поддержка)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Цена имплементации (\$C_M\$):<br>
<span class="image"><img src="./images/example-01.png" alt="Example01"></span></p>
</div>
<div class="paragraph">
<p>Риски до имплементации:<br>
<span class="image"><img src="./images/example-02.png" alt="Example02"></span></p>
</div>
<div class="paragraph">
<p>Риски после:<br>
<span class="image"><img src="./images/example-03.png" alt="Example03"></span></p>
</div>
<div class="paragraph">
<p>Итого экономия за 5 лет от повышения доступности составляет:<br>
\$S=R_B-R_A-C_M\$<br>
<code>$600000-$122250-$96000=$477750</code><br>
Детальная калькуляция с описанием допущений доступна в <a href="https://docs.google.com/spreadsheets/d/16Ga8WSc5xxufbSAabo5vyviKlbLundlm1cjsZCi2Qxw/edit?usp=sharing">Example-01: Risk calculation (Google Sheet)</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Арифметика_доступности_итоги">Арифметика доступности: итоги</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Рассмотренный пример, пусть и в достаточно упрощенной форме, демонстрирует общий подход как на основе достаточно простых калькуляций сделать прогноз по окупаемости вложений в доступность сервиса. Как уже было описано ранее, увеличение доступности есть увеличение MTBF, либо уменьшение MTTR и второй вариант является, чаще всего, более дешевым из-за улучшения рабочих процедур, использования лучших практик, а не за счет покупки крайне дорогого оборудования, которое все же будет иметь вероятность возникновения сбоя из-за каких-либо дефектов, ошибок так и в силу внешних факторов.</p>
</div>
<div class="paragraph">
<p>Таким образом можно схематически отобразить зависимость между затратами и увеличением доступности:<br>
<span class="image"><img src="./images/investments.jpg" alt="investments" width="600" height="600"></span></p>
</div>
<div class="paragraph">
<p>На изображении также представлен “стек” практик, которые следует последовательно (снизу вверх) вводить для достижения требуемого уровня надежности системы. Именно за счет последовательности в управлении надежности эта самая надежность и достигается, так как без нижележащего уровня высокий уровень будет иметь не так много смысла и даже его использование может быть осложнено или невозможно в принципе.</p>
</div>
<div class="paragraph">
<p>Более подробно эти практики рассмотрим в последующих статьях.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Ссылки">Ссылки</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="sr"></a>[sr] 3 Steps to IT Resilience with Forrester - <a href="https://vimeo.com/182883763" class="bare">https://vimeo.com/182883763</a></p>
</li>
<li>
<p><a id="hadr"></a>[hadr] High Availability and Disaster Recovery: Concepts, Design, Implementation, Klaus Schmidt (2006)</p>
</li>
<li>
<p><a id="snia"></a>[snia] SNIA: Dictionary - <a href="https://www.snia.org/education/dictionary" class="bare">https://www.snia.org/education/dictionary</a></p>
</li>
<li>
<p><a id="bcdr"></a>[bcdr] Business Continuity and Disaster Recovery Plan for Information Security (Heng, 1996)</p>
</li>
<li>
<p><a id="bcp"></a>[bcp] BCP - <a href="https://en.wikipedia.org/wiki/Business_continuity_planning" class="bare">https://en.wikipedia.org/wiki/Business_continuity_planning</a></p>
</li>
</ul>
</div>
</div>
</div>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/high-availablitiy/">high-availablitiy</a>
  
  <a class="badge badge-light" href="/tags/distributed-systems/">distributed-systems</a>
  
  <a class="badge badge-light" href="/tags/ha/">HA</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/2019/02-distsys/&amp;text=%d0%a1%d0%b1%d0%be%d0%b8%20%d0%b8%20%d0%b2%d0%be%d1%81%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5%20%d1%80%d0%b0%d0%b1%d0%be%d1%82%d0%be%d1%81%d0%bf%d0%be%d0%b1%d0%bd%d0%be%d1%81%d1%82%d0%b8%20%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/2019/02-distsys/&amp;t=%d0%a1%d0%b1%d0%be%d0%b8%20%d0%b8%20%d0%b2%d0%be%d1%81%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5%20%d1%80%d0%b0%d0%b1%d0%be%d1%82%d0%be%d1%81%d0%bf%d0%be%d0%b1%d0%bd%d0%be%d1%81%d1%82%d0%b8%20%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=%d0%a1%d0%b1%d0%be%d0%b8%20%d0%b8%20%d0%b2%d0%be%d1%81%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5%20%d1%80%d0%b0%d0%b1%d0%be%d1%82%d0%be%d1%81%d0%bf%d0%be%d0%b1%d0%bd%d0%be%d1%81%d1%82%d0%b8%20%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc&amp;body=/post/2019/02-distsys/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/2019/02-distsys/&amp;title=%d0%a1%d0%b1%d0%be%d0%b8%20%d0%b8%20%d0%b2%d0%be%d1%81%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5%20%d1%80%d0%b0%d0%b1%d0%be%d1%82%d0%be%d1%81%d0%bf%d0%be%d0%b1%d0%bd%d0%be%d1%81%d1%82%d0%b8%20%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=%d0%a1%d0%b1%d0%be%d0%b8%20%d0%b8%20%d0%b2%d0%be%d1%81%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5%20%d1%80%d0%b0%d0%b1%d0%be%d1%82%d0%be%d1%81%d0%bf%d0%be%d0%b1%d0%bd%d0%be%d1%81%d1%82%d0%b8%20%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%20/post/2019/02-distsys/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
  </ul>
</div>












  






  
  
  
    
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="portrait mr-3" src="/authors/salimonov/avatar_salimonov_small_hu469099bcddfca1270d43d68bcc28120c_29069_250x250_fill_q90_lanczos_center.jpeg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Alexander Salimonov</a></h5>
      <h6 class="card-subtitle">Engineering Manager</h6>
      <p class="card-text">Distributed and data-intensive sytems, databases, data processing, cloud computing.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/asalimonov" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/asalimonov" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="/files/Alexander_Salimonov_CV.pdf" >
        <i class="ai ai-cv"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>









  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/post/2019/01-distsys/">Системы с высокой доступностью</a></li>
      
    </ul>
  </div>
  



  </div>
</article>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>


      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/sql.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/json.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/yaml.min.js"></script>
        
      

      
      
    

    
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.3227ab49eed49815d1b4ba40154f74e7.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    Alexander Salimonov · ©  2019 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
